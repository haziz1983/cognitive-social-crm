"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var watson=require("watson-developer-cloud"),Logger_1=require("../util/Logger"),SocialCRMWorkspace_1=require("../data/SocialCRMWorkspace"),ConversationInitializer=function(){function ConversationInitializer(){this.DEFAULT_NAME="cognitive-social-crm",this.conversation=new watson.AssistantV1({version:"2018-02-16"})}return ConversationInitializer.prototype.init=function(){var _this=this;return new Promise(function(resolve,reject){var conversationSetupParams={default_name:_this.DEFAULT_NAME,workspace_json:SocialCRMWorkspace_1.default};_this.setupConversationWorkspace(conversationSetupParams).then(function(workspaceId){resolve(workspaceId)}).catch(function(err){Logger_1.default.error(err),reject(err)})})},ConversationInitializer.prototype.setupConversationWorkspace=function(params){var _this=this;return new Promise(function(resolve,reject){_this.conversation.listWorkspaces({},function(err,data){var workspaceId="";if(err)Logger_1.default.error("Error during Conversation listWorkspaces(): ",err),reject(new Error("Error. Unable to list workspaces for Conversation: "+err));else{var workspaces=data.workspaces,found=!1;Logger_1.default.log("Looking for workspace by name: ",_this.DEFAULT_NAME);for(var i=0,size=workspaces.length;i<size;i++)if(workspaces[i].name===_this.DEFAULT_NAME){Logger_1.default.log("Found workspace: ",_this.DEFAULT_NAME),workspaceId=workspaces[i].workspace_id,Logger_1.default.log(" ID: ",workspaceId),found=!0;break}if(found)resolve(workspaceId);else{Logger_1.default.log("Creating Conversation workspace ",_this.DEFAULT_NAME);var ws=params.workspace_json;ws.name=_this.DEFAULT_NAME,_this.conversation.createWorkspace(ws,function(error,wsResp){error?reject(new Error("Failed to create Conversation workspace: "+err)):(workspaceId=wsResp.workspace_id,Logger_1.default.log("Successfully created Conversation workspace"),Logger_1.default.log("  Name: ",wsResp.name),Logger_1.default.log("  ID:",workspaceId),resolve(workspaceId))})}}})})},ConversationInitializer}();exports.ConversationInitializer=ConversationInitializer;